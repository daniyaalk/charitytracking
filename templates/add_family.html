{% extends 'layout.html' %}

{% block body %}
<script type="text/javascript">
  // multiplication table
  const d = [
  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
  [1, 2, 3, 4, 0, 6, 7, 8, 9, 5],
  [2, 3, 4, 0, 1, 7, 8, 9, 5, 6],
  [3, 4, 0, 1, 2, 8, 9, 5, 6, 7],
  [4, 0, 1, 2, 3, 9, 5, 6, 7, 8],
  [5, 9, 8, 7, 6, 0, 4, 3, 2, 1],
  [6, 5, 9, 8, 7, 1, 0, 4, 3, 2],
  [7, 6, 5, 9, 8, 2, 1, 0, 4, 3],
  [8, 7, 6, 5, 9, 3, 2, 1, 0, 4],
  [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
  ]

  // permutation table
  const p = [
  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
  [1, 5, 7, 6, 2, 8, 3, 0, 9, 4],
  [5, 8, 0, 3, 7, 9, 6, 1, 4, 2],
  [8, 9, 1, 6, 0, 4, 3, 5, 2, 7],
  [9, 4, 5, 3, 1, 2, 6, 8, 7, 0],
  [4, 2, 8, 6, 5, 7, 3, 9, 0, 1],
  [2, 7, 9, 3, 8, 0, 6, 4, 1, 5],
  [7, 0, 4, 6, 9, 1, 3, 2, 5, 8]
  ]

  // validates Aadhar number received as string
  function validate(aadharNumber) {
  let c = 0
  let invertedArray = aadharNumber.split('').map(Number).reverse()

  invertedArray.forEach((val, i) => {
    c = d[c][p[(i % 8)][val]]
  })

  return (c === 0)
  }

  function checkUUID(){

    uuid = document.getElementById("uuid").value;

    if(validate(uuid)&&uuid.length==12){
      document.getElementById("form").submit();
    }else{
      alert("Aadhaar number is invalid")
    }

  }
</script>
<h1>Add Family</h1>
{% from 'includes/_formhelpers.html' import render_field %}
<form action="" id="form" method="post">
  <div class="form-group">
    {{render_field(form.name, class_="form-control")}}
  </div>

  <div class="form-group">
    {{render_field(form.plot_number, class_="form-control")}}
  </div>
  <div class="form-group">
    {{render_field(form.gut_number, class_="form-control")}}
  </div>
  <div class="form-group">
    {{render_field(form.layout, class_="form-control")}}
  </div>
  <div class="form-group">
    {{render_field(form.mouza, class_="form-control")}}
  </div>

  <div class="form-group">
    {{render_field(form.occupation, class_="form-control")}}
  </div>

  <div class="form-group">
    {{render_field(form.mobile_number, class_="form-control")}}
  </div>
  <div class="form-group">
    {{render_field(form.uuid, class_="form-control", id="uuid")}}
  </div>
  <div class="form-group">
    {{render_field(form.adults_count, class_="form-control")}}
  </div>
  <div class="form-group">
    {{render_field(form.children_count, class_="form-control")}}
  </div>

  <input type="button" onclick="checkUUID()" name="Create" value="Add" class="btn btn-primary">
</form>
{% endblock %}
